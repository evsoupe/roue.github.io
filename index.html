<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roue de la Fortune - Tentez votre chance !</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4CAF50;
            --secondary: #66BB6A;
            --accent: #81C784;
            --dark: #2E7D32;
            --light: #fff;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(129, 199, 132, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--light);
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
            display: flex;
            align-items: center;
        }

        /* RESPONSIVE MOBILE */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 10px;
                margin: 5px auto;
            }

            .game-container {
                padding: 20px 15px;
                border-radius: 20px;
            }

            .nav {
                flex-direction: column;
                gap: 10px;
                padding: 15px 10px;
                text-align: center;
                margin-bottom: 20px;
            }

            .logo {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 8px;
            }

            #logoImage {
                height: 45px !important;
                margin-right: 0 !important;
            }

            .admin-btn {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: auto;
                padding: 12px 20px;
                z-index: 100;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                font-size: 0.9rem;
            }

            h1 {
                font-size: 1.8rem;
                line-height: 1.2;
                margin-bottom: 15px;
            }

            .subtitle {
                font-size: 0.95rem;
                line-height: 1.4;
                padding: 0 10px;
            }

            .email-form {
                gap: 12px;
                padding: 0 5px;
            }

            .email-input {
                font-size: 16px;
                padding: 14px;
            }

            .play-btn {
                padding: 16px 30px;
                font-size: 1rem;
                width: 100%;
            }

            .wheel-container {
                margin: 25px auto;
                width: 100%;
                max-width: 320px;
                display: flex;
                justify-content: center;
                align-items: center;
                position: relative;
            }

            .wheel {
                width: 280px !important;
                height: 280px !important;
                margin: 0 auto;
                position: relative;
            }

            #wheelCanvas {
                width: 280px !important;
                height: 280px !important;
                display: block;
                margin: 0 auto;
            }

            .wheel-center {
                width: 60px !important;
                height: 60px !important;
                font-size: 1.2rem;
            }

            .wheel-pointer {
                right: -18px;
                border-top: 12px solid transparent;
                border-bottom: 12px solid transparent;
                border-right: 25px solid var(--primary);
                z-index: 20;
            }

            .message {
                font-size: 0.9rem;
                padding: 12px;
                margin: 15px 5px;
            }

            /* Admin responsive */
            .admin-container {
                padding: 15px 10px;
            }

            .admin-container > div:first-child {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 12px;
            }

            .admin-container h1 {
                font-size: 1.6rem;
            }

            #syncIndicator {
                width: 100%;
                justify-content: center;
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            .admin-tabs {
                flex-direction: column;
                gap: 8px;
            }

            .tab-btn {
                width: 100%;
                text-align: center;
                padding: 12px 20px;
                font-size: 0.95rem;
            }

            .prize-item {
                padding: 12px;
                margin-bottom: 12px;
            }

            .prize-item > div:first-child {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }

            .prize-input, .percentage-input, .message-input {
                width: 100%;
                font-size: 15px;
                padding: 12px;
            }

            .add-prize-btn, .save-btn, .remove-prize-btn {
                width: 100%;
                margin: 5px 0;
                padding: 12px 20px;
                font-size: 0.95rem;
            }

            /* Tableaux en cartes sur mobile */
            .participants-table {
                font-size: 0.9rem;
            }

            .participants-table thead {
                display: none;
            }

            .participants-table,
            .participants-table tbody,
            .participants-table tr,
            .participants-table td {
                display: block;
                width: 100%;
            }

            .participants-table tr {
                margin-bottom: 15px;
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                padding: 15px;
                background: white;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .participants-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border: none;
                text-align: left !important;
            }

            .participants-table td:before {
                content: attr(data-label);
                font-weight: bold;
                color: var(--dark);
                margin-right: 10px;
                flex-shrink: 0;
            }

            /* Modal responsive */
            .result-modal, .password-modal {
                padding: 10px;
            }

            .result-content {
                width: 95%;
                max-width: 100%;
                padding: 25px 18px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .result-content h2 {
                font-size: 1.8rem;
            }

            .result-content p {
                font-size: 1.1rem;
            }

            .prize-name {
                font-size: 1.6rem;
                padding: 15px;
                margin: 20px 0;
            }

            .close-btn, .pdf-btn {
                padding: 14px 25px;
                font-size: 1rem;
                margin: 8px 5px;
                width: calc(50% - 10px);
            }

            .password-modal .result-content {
                width: 90%;
                padding: 30px 20px;
            }

            /* Formulaire RGPD responsive */
            #rgpdCheckbox {
                width: 20px !important;
                height: 20px !important;
                flex-shrink: 0;
                margin-top: 2px;
            }

            #rgpdCheckboxText {
                font-size: 0.9rem;
                line-height: 1.5;
            }

            /* Section validation bons */
            #voucherCodeInput {
                font-size: 16px;
            }

            #voucherPreview {
                padding: 15px;
                font-size: 0.9rem;
            }

            #voucherPreview > div:last-child {
                flex-direction: column;
                gap: 10px;
            }

            #voucherPreview button {
                width: 100%;
            }

            /* Pagination responsive */
            #pageInfo {
                padding: 0 8px !important;
                font-size: 0.85rem;
            }

            #prevPageBtn, #nextPageBtn {
                padding: 8px 10px !important;
                font-size: 0.85rem;
            }

            /* Tous les boutons d'action en colonne */
            .admin-container > div[style*="flex"] {
                flex-direction: column !important;
            }

            .admin-container button {
                width: 100%;
                margin: 5px 0;
            }

            /* Scanner QR responsive */
            #qrReader {
                max-width: 100% !important;
            }

            /* S√©lecteurs de couleur plus accessibles */
            input[type="color"] {
                width: 80px !important;
                height: 50px !important;
            }

            /* Param√®tres - champs de texte */
            .email-input[type="url"],
            .email-input[type="text"],
            .email-input[type="password"] {
                font-size: 16px;
            }

            /* PDF param√®tres - grid en colonne */
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            /* RGPD modal */
            #rgpdModal .result-content {
                padding: 20px 15px;
                font-size: 0.9rem;
            }

            #rgpdContent {
                font-size: 0.85rem;
                line-height: 1.6;
            }

            #rgpdContent h3 {
                font-size: 1.1rem;
                margin-top: 15px;
            }

            #rgpdContent ul, #rgpdContent ol {
                padding-left: 25px;
            }

            /* Back button plus accessible */
            .back-btn {
                width: 100%;
                margin-bottom: 15px;
                padding: 14px;
                font-size: 1rem;
            }

            /* Status badges lisibles */
            .status-badge {
                font-size: 0.85rem;
                padding: 4px 10px;
            }
        }

        /* Tr√®s petits √©crans (iPhone SE, etc.) */
        @media (max-width: 400px) {
            .logo {
                font-size: 1.5rem;
            }

            h1 {
                font-size: 1.6rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            #wheelCanvas {
                width: 240px !important;
                height: 240px !important;
            }

            .play-btn {
                padding: 14px 25px;
                font-size: 0.95rem;
            }

            .result-content h2 {
                font-size: 1.6rem;
            }

            .prize-name {
                font-size: 1.4rem;
            }

            .admin-container h1 {
                font-size: 1.4rem;
            }

            .tab-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        /* Am√©lioration tactile pour tous les appareils */
        @media (hover: none) and (pointer: coarse) {
            button, .tab-btn {
                min-height: 44px;
                min-width: 44px;
            }

            input[type="checkbox"] {
                min-width: 24px;
                min-height: 24px;
            }

            /* Espacement entre √©l√©ments tactiles */
            .admin-tabs .tab-btn {
                margin: 4px 0;
            }

            .prize-item button {
                margin: 4px 0;
            }
        }
                flex-direction: column !important;
            }

            .admin-container button {
                width: 100%;
            }

            /* Messages responsive */
            .message {
                font-size: 0.9rem;
                padding: 12px;
            }

            /* Status badges */
            .status-badge {
                display: inline-block;
            }

            /* Champs de texte dans param√®tres */
            .message-input {
                font-size: 16px;
            }

            /* S√©lecteur de couleur */
            input[type="color"] {
                width: 60px !important;
                height: 60px !important;
            }

            /* QR Scanner */
            #qrReader {
                max-width: 100% !important;
            }

            /* Preview du bon */
            #voucherPreview {
                padding: 15px;
            }

            #voucherPreview > div:first-child {
                font-size: 0.9rem;
            }
        }

        /* Tr√®s petits √©crans */
        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            #wheelCanvas {
                width: 250px !important;
                height: 250px !important;
            }

            .play-btn {
                padding: 15px 25px;
                font-size: 1rem;
            }

            .result-content h2 {
                font-size: 1.8rem;
            }
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-section, .admin-section {
            display: none;
        }

        .game-section.active, .admin-section.active {
            display: block;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            color: var(--dark);
            margin-bottom: 15px;
            letter-spacing: 3px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .email-form {
            max-width: 500px;
            margin: 0 auto 40px;
        }

        .email-input {
            width: 100%;
            padding: 18px 25px;
            border: 3px solid #e0e0e0;
            border-radius: 50px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .email-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1);
        }

        .play-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 18px 60px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 2px;
        }

        .play-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 53, 0.4);
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 50px auto;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            transform: rotate(0deg);
        }

        .wheel-pointer {
            position: absolute;
            top: 50%;
            right: -30px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 20px solid transparent;
            border-bottom: 20px solid transparent;
            border-right: 40px solid var(--primary);
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
            z-index: 10;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .result-modal.active {
            display: flex;
        }

        .result-content {
            background: white;
            padding: 60px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            animation: bounceIn 0.6s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .result-content h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .result-content p {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 30px;
        }

        .close-btn {
            background: var(--dark);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .admin-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .admin-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-family: 'Poppins', sans-serif;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .prize-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .prize-item {
            display: grid;
            grid-template-columns: 2fr 1fr auto auto auto;
            gap: 15px;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 15px;
            align-items: center;
        }

        .prize-input, .percentage-input {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
        }

        .message-input {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            width: 100%;
        }

        .winning-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--dark);
            white-space: nowrap;
        }

        .remove-prize-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-prize-btn:hover {
            background: #e84352;
            transform: translateY(-2px);
        }

        .add-prize-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .add-prize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .save-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 2px;
        }

        .save-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .participants-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Masquer les labels data sur desktop */
        .participants-table td:before {
            content: none;
            display: none;
        }

        .participants-table th,
        .participants-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .participants-table th {
            background: var(--dark);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .participants-table tr:hover {
            background: #f8f8f8;
        }

        .message {
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .message.error {
            background: #ffe5e5;
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.valid {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-badge.used {
            background: #ffe5e5;
            color: #d32f2f;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .wheel-container {
                width: 350px;
                height: 350px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .game-container, .admin-container {
                padding: 30px 20px;
            }

            .prize-item {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <div class="logo" id="siteLogo">
                <img id="logoImage" src="" alt="" style="display: none; height: 60px; margin-right: 15px;">
                <span id="logoText">ROUE MAGIQUE</span>
            </div>
            <button class="admin-btn" id="adminToggle">Admin</button>
        </div>

        <!-- Modal RGPD -->
        <div class="result-modal" id="rgpdModal">
            <div class="result-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
                <h2 style="color: var(--dark); margin-bottom: 20px;">Protection de vos donn√©es personnelles</h2>
                
                <div style="text-align: left; font-size: 0.95rem; line-height: 1.6; color: #333;" id="rgpdContent">
                    <!-- Le contenu sera rempli dynamiquement -->
                </div>
                
                <div style="display: flex; justify-content: center; margin-top: 30px;">
                    <button class="play-btn" id="closeRgpdModal" style="padding: 15px 40px;">
                        Fermer
                    </button>
                </div>
            </div>
        </div>

        <!-- Section Jeu -->
        <div class="game-section active" id="gameSection">
            <div class="game-container">
                <h1>Tournez & Gagnez !</h1>
                <p class="subtitle">Entrez votre email et tentez votre chance pour gagner des lots incroyables</p>

                <div class="email-form">
                    <input type="text" class="email-input" id="firstNameInput" placeholder="Pr√©nom" required>
                    <input type="text" class="email-input" id="lastNameInput" placeholder="Nom" required>
                    <input type="email" class="email-input" id="emailInput" placeholder="votre@email.com" required>
                    
                    <div style="margin: 20px 0; text-align: left; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px;">
                        <label style="display: flex; align-items: flex-start; cursor: pointer; font-size: 0.95rem;">
                            <input type="checkbox" id="rgpdCheckbox" style="width: 20px; height: 20px; margin-right: 10px; margin-top: 2px; cursor: pointer;" required>
                            <span id="rgpdCheckboxText">
                                J'accepte la politique de protection des donn√©es. 
                                <a href="#" id="rgpdLink" style="color: var(--primary); text-decoration: underline; font-weight: 600;">
                                    Cliquez ici pour consulter
                                </a>
                            </span>
                        </label>
                    </div>
                    
                    <button class="play-btn" id="playBtn">TOURNER LA ROUE</button>
                </div>

                <div id="message"></div>

                <div class="wheel-container">
                    <div class="wheel-pointer"></div>
                    <div class="wheel" id="wheelRotate">
                        <canvas id="wheelCanvas" width="500" height="500"></canvas>
                        <div class="wheel-center">üéÅ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Mot de passe Admin -->
        <div class="result-modal" id="passwordModal" style="z-index: 2000;">
            <div class="result-content">
                <h2>üîê Acc√®s Admin</h2>
                <p style="font-size: 1rem; margin-bottom: 20px;">Entrez le mot de passe</p>
                <input type="password" id="passwordInput" class="email-input" 
                       placeholder="Mot de passe" style="margin-bottom: 15px;">
                <div id="passwordError" style="margin-bottom: 15px;"></div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="close-btn" id="cancelPassword">Annuler</button>
                    <button class="play-btn" id="submitPassword" style="padding: 15px 30px; font-size: 1rem;">
                        Valider
                    </button>
                </div>
            </div>
        </div>

        <!-- Section Admin -->
        <div class="admin-section" id="adminSection">
            <button class="back-btn" id="backBtn">‚Üê Retour au jeu</button>
            <div class="admin-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1 style="margin: 0;">Panneau d'Administration</h1>
                    <div id="syncIndicator" style="display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: #e8f5e9; border-radius: 20px; font-size: 0.9rem;">
                        <span style="width: 10px; height: 10px; background: #4CAF50; border-radius: 50%; animation: pulse 2s infinite;"></span>
                        <span style="color: #2E7D32; font-weight: 600;">Synchronisation active</span>
                    </div>
                </div>

                <style>
                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                </style>

                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="prizes">Lots & Probabilit√©s</button>
                    <button class="tab-btn" data-tab="participants">Participants</button>
                    <button class="tab-btn" data-tab="vouchers">Validation Bons</button>
                    <button class="tab-btn" data-tab="pdf">PDF</button>
                    <button class="tab-btn" data-tab="settings">Param√®tres</button>
                </div>

                <!-- Onglet Lots -->
                <div class="tab-content active" id="prizesTab">
                    <div id="prizesList" class="prize-list"></div>
                    <button class="add-prize-btn" id="addPrizeBtn">+ Ajouter un lot</button>
                    <div id="adminMessage"></div>
                    <button class="save-btn" id="savePrizesBtn">üíæ Enregistrer les modifications</button>
                </div>

                <!-- Onglet Participants -->
                <div class="tab-content" id="participantsTab">
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button class="add-prize-btn" id="exportExcelBtn">
                            üìä T√©l√©charger Excel
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <p style="color: #666; margin: 0;">
                            <span id="participantsCount">0</span> participant(s) total
                        </p>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="close-btn" id="prevPageBtn" style="padding: 8px 15px;">
                                ‚Üê Pr√©c√©dent
                            </button>
                            <span id="pageInfo" style="padding: 0 15px; font-weight: 600;">Page 1</span>
                            <button class="close-btn" id="nextPageBtn" style="padding: 8px 15px;">
                                Suivant ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <table class="participants-table">
                        <thead>
                            <tr>
                                <th>Pr√©nom</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Lot Gagn√©</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="participantsBody">
                        </tbody>
                    </table>
                </div>

                <!-- Onglet Validation Bons -->
                <div class="tab-content" id="vouchersTab">
                    <div style="max-width: 600px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--dark);">Valider un bon</h3>
                        <div style="display: flex; gap: 15px; align-items: flex-start; margin-bottom: 20px;">
                            <input type="text" id="voucherCodeInput" class="email-input" 
                                   placeholder="Entrez le code du bon" style="margin-bottom: 0;">
                            <button class="play-btn" id="verifyVoucherBtn" style="padding: 18px 40px;">
                                V√©rifier
                            </button>
                        </div>
                        
                        <!-- Pr√©visualisation du bon -->
                        <div id="voucherPreview" style="display: none; background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid var(--primary);">
                            <h4 style="color: var(--dark); margin-top: 0;">Informations du bon :</h4>
                            <div style="display: grid; gap: 10px;">
                                <div><strong>Code :</strong> <span id="previewCode"></span></div>
                                <div><strong>Pr√©nom :</strong> <span id="previewFirstName"></span></div>
                                <div><strong>Nom :</strong> <span id="previewLastName"></span></div>
                                <div><strong>Email :</strong> <span id="previewEmail"></span></div>
                                <div><strong>Lot :</strong> <span id="previewPrize"></span></div>
                                <div><strong>Date cr√©ation :</strong> <span id="previewDate"></span></div>
                                <div><strong>Statut :</strong> <span id="previewStatus"></span></div>
                            </div>
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="play-btn" id="confirmValidateBtn" style="padding: 15px 30px;">
                                    ‚úÖ Valider le bon
                                </button>
                                <button class="close-btn" id="cancelValidateBtn">
                                    Annuler
                                </button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <button class="add-prize-btn" id="toggleQrScannerBtn">
                                üì∑ Scanner un QR Code
                            </button>
                        </div>

                        <div id="qrScannerContainer" style="display: none; margin-bottom: 20px;">
                            <div id="qrReader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                            <button class="close-btn" id="stopQrScannerBtn" style="margin-top: 15px;">
                                Arr√™ter le scanner
                            </button>
                        </div>

                        <div id="validationMessage" style="margin-top: 15px;"></div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button class="add-prize-btn" id="exportVouchersBtn">
                            üìä T√©l√©charger Excel (Bons)
                        </button>
                        <button class="remove-prize-btn" id="resetVouchersBtn" style="padding: 10px 30px;">
                            üóëÔ∏è R√©initialiser l'historique
                        </button>
                    </div>

                    <h3 style="margin-bottom: 20px; color: var(--dark);">Historique des bons</h3>
                    <table class="participants-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Pr√©nom</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Lot</th>
                                <th>Date cr√©ation</th>
                                <th>Statut</th>
                                <th>Date validation</th>
                            </tr>
                        </thead>
                        <tbody id="vouchersBody">
                        </tbody>
                    </table>
                </div>

                <!-- Onglet PDF -->
                <div class="tab-content" id="pdfTab">
                    <h3 style="margin-bottom: 30px; color: var(--dark);">Personnalisation du PDF</h3>
                    
                    <div style="max-width: 700px; display: flex; flex-direction: column; gap: 25px;">
                        <h4 style="color: var(--dark); margin-bottom: 10px;">Textes du PDF</h4>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Titre principal du PDF
                            </label>
                            <input type="text" id="pdfTitle" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Texte "Vous avez gagn√©"
                            </label>
                            <input type="text" id="pdfYouWonText" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Label du code
                            </label>
                            <input type="text" id="pdfCodeLabel" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Instruction 1
                            </label>
                            <input type="text" id="pdfInstruction1" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Instruction 2
                            </label>
                            <input type="text" id="pdfInstruction2" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <h4 style="color: var(--dark); margin-top: 20px; margin-bottom: 10px;">Couleurs du PDF</h4>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                    Couleur en-t√™te
                                </label>
                                <input type="color" id="pdfHeaderColor" style="width: 100%; height: 50px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;">
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                    Couleur accent (fond lot)
                                </label>
                                <input type="color" id="pdfAccentColor" style="width: 100%; height: 50px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;">
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                    Couleur texte principal
                                </label>
                                <input type="color" id="pdfPrimaryTextColor" style="width: 100%; height: 50px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;">
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                    Couleur bordure
                                </label>
                                <input type="color" id="pdfBorderColor" style="width: 100%; height: 50px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer;">
                            </div>
                        </div>

                        <div id="pdfMessage"></div>
                        <button class="save-btn" id="savePdfSettingsBtn">üíæ Enregistrer la personnalisation PDF</button>
                    </div>
                </div>

                <!-- Onglet Param√®tres -->
                <div class="tab-content" id="settingsTab">
                    <h3 style="margin-bottom: 30px; color: var(--dark);">Personnalisation des textes</h3>
                    
                    <div style="max-width: 700px; display: flex; flex-direction: column; gap: 25px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Logo (URL de l'image)
                            </label>
                            <input type="url" id="textLogoUrl" class="email-input" style="margin-bottom: 0;" 
                                   placeholder="https://exemple.com/mon-logo.png">
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                Entrez l'URL de votre logo (h√©berg√© en ligne). Recommand√© : PNG transparent, hauteur 60px
                            </p>
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Nom du site (logo)
                            </label>
                            <input type="text" id="textSiteName" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Titre principal
                            </label>
                            <input type="text" id="textMainTitle" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Sous-titre
                            </label>
                            <textarea id="textSubtitle" class="message-input" rows="2"></textarea>
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Texte du bouton jouer
                            </label>
                            <input type="text" id="textPlayButton" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Placeholder pr√©nom
                            </label>
                            <input type="text" id="textFirstNamePlaceholder" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Placeholder nom
                            </label>
                            <input type="text" id="textLastNamePlaceholder" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Placeholder de l'email
                            </label>
                            <input type="text" id="textEmailPlaceholder" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Titre popup de r√©sultat
                            </label>
                            <input type="text" id="textResultTitle" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Texte du bouton PDF
                            </label>
                            <input type="text" id="textPdfButton" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div id="textsMessage"></div>
                        <button class="save-btn" id="saveTextsBtn">üíæ Enregistrer les textes</button>

                        <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">

                        <h3 style="color: var(--dark); margin-top: 20px;">R√©initialisation des emails</h3>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Permettre aux emails de rejouer tous les :
                            </label>
                            <select id="emailResetPeriodSelect" class="email-input" style="margin-bottom: 15px;">
                                <option value="never">Jamais (1 seule participation)</option>
                                <option value="daily">Chaque jour</option>
                                <option value="2days">Tous les 2 jours</option>
                                <option value="3days">Tous les 3 jours</option>
                                <option value="weekly">Chaque semaine</option>
                            </select>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                                Les participants pourront rejouer apr√®s la p√©riode s√©lectionn√©e
                            </p>
                            <div style="display: flex; gap: 15px;">
                                <button class="save-btn" id="saveResetPeriodBtn" style="padding: 12px 30px; font-size: 1rem;">
                                    üíæ Enregistrer la p√©riode
                                </button>
                                <button class="remove-prize-btn" id="resetEmailsNowBtn" style="padding: 10px 30px;">
                                    üîÑ R√©initialiser maintenant
                                </button>
                            </div>
                            <p style="font-size: 0.85rem; color: #999; margin-top: 10px;">
                                Le bouton "R√©initialiser maintenant" efface uniquement la liste des emails ayant particip√© (pas l'historique complet)
                            </p>
                        </div>

                        <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">

                        <h3 style="color: var(--dark); margin-top: 20px;">Changer le mot de passe admin</h3>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Mot de passe actuel
                            </label>
                            <input type="password" id="currentPassword" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Nouveau mot de passe
                            </label>
                            <input type="password" id="newPassword" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Confirmer le nouveau mot de passe
                            </label>
                            <input type="password" id="confirmPassword" class="email-input" style="margin-bottom: 0;">
                        </div>

                        <div id="passwordMessage"></div>
                        <button class="save-btn" id="changePasswordBtn">üîê Modifier le mot de passe</button>

                        <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

                        <h3 style="color: var(--dark);">Param√®tres RGPD</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                            Personnalisez le texte de la case √† cocher et le contenu de la politique RGPD
                        </p>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Texte de la case √† cocher (HTML autoris√©)
                            </label>
                            <textarea id="rgpdCheckboxTextInput" class="message-input" rows="3" 
                                      placeholder="Ex: J'accepte la politique..."></textarea>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                Astuce : Utilisez du HTML. Exemple pour le lien : 
                                <code style="background: #f0f0f0; padding: 2px 5px; border-radius: 3px;">
                                    &lt;a href="#" id="rgpdLink"&gt;Cliquez ici&lt;/a&gt;
                                </code>
                            </p>
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark);">
                                Contenu complet de la politique RGPD (HTML)
                            </label>
                            <textarea id="rgpdFullTextInput" class="message-input" rows="15" 
                                      placeholder="Entrez le texte complet de votre politique RGPD (HTML accept√©)"></textarea>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                Vous pouvez utiliser du HTML : &lt;h3&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;, etc.
                            </p>
                        </div>

                        <div id="rgpdMessage"></div>
                        <button class="save-btn" id="saveRgpdBtn">üíæ Enregistrer les param√®tres RGPD</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal R√©sultat -->
        <div class="result-modal" id="resultModal">
            <div class="result-content">
                <h2>üéâ F√©licitations !</h2>
                <p id="resultText"></p>
                <button class="close-btn" id="closeModal">Fermer</button>
            </div>
        </div>
    </div>

    <script>
        // Stockage avec window.storage
        const STORAGE_KEYS = {
            PRIZES: 'wheel-prizes',
            PARTICIPANTS: 'wheel-participants',
            VOUCHERS: 'wheel-vouchers',
            ADMIN_PASSWORD: 'wheel-admin-password',
            CUSTOM_TEXTS: 'wheel-custom-texts',
            PDF_SETTINGS: 'wheel-pdf-settings',
            RGPD_SETTINGS: 'wheel-rgpd-settings',
            RGPD_CONSENT: 'wheel-rgpd-consent',
            LAST_UPDATE: 'wheel-last-update'
        };

        // Donn√©es par d√©faut
        const DEFAULT_PRIZES = [
            { name: 'iPhone 15', percentage: 5, isWinning: true, message: 'Incroyable ! Vous avez remport√© un iPhone 15 !', color: '#4CAF50' },
            { name: 'MacBook Pro', percentage: 3, isWinning: true, message: 'F√©licitations ! Un MacBook Pro est √† vous !', color: '#66BB6A' },
            { name: 'PlayStation 5', percentage: 10, isWinning: true, message: 'Youpi ! Vous gagnez une PlayStation 5 !', color: '#81C784' },
            { name: 'AirPods Pro', percentage: 15, isWinning: true, message: 'Super ! Des AirPods Pro vous attendent !', color: '#A5D6A7' },
            { name: 'Bon d\'achat 100‚Ç¨', percentage: 20, isWinning: true, message: 'Bravo ! Vous remportez un bon d\'achat de 100‚Ç¨ !', color: '#2E7D32' },
            { name: 'Bon d\'achat 50‚Ç¨', percentage: 27, isWinning: true, message: 'G√©nial ! Un bon d\'achat de 50‚Ç¨ pour vous !', color: '#388E3C' },
            { name: 'R√©essayez', percentage: 20, isWinning: false, message: 'Dommage ! Retentez votre chance une prochaine fois !', color: '#43A047' }
        ];

        // Variables globales
        let prizes = [];
        let participants = [];
        let vouchers = [];
        let isSpinning = false;
        let qrScanner = null;
        let adminPassword = 'admin123';
        let customTexts = {
            siteName: 'ROUE MAGIQUE',
            logoUrl: '', // URL de l'image du logo
            mainTitle: 'Tournez & Gagnez !',
            subtitle: 'Entrez vos informations et tentez votre chance pour gagner des lots incroyables',
            playButton: 'TOURNER LA ROUE',
            firstNamePlaceholder: 'Pr√©nom',
            lastNamePlaceholder: 'Nom',
            emailPlaceholder: 'votre@email.com',
            resultTitle: 'üéâ F√©licitations !',
            pdfButtonText: 'üìÑ T√©l√©charger mon bon',
            noWinMessage: 'Dommage ! Retentez votre chance une prochaine fois !'
        };
        let pdfSettings = {
            title: 'üéâ F√âLICITATIONS !',
            youWonText: 'Vous avez gagn√©',
            codeLabel: 'Votre code unique :',
            instruction1: 'Pr√©sentez ce bon pour r√©cup√©rer votre lot',
            instruction2: 'Ce code ne peut √™tre utilis√© qu\'une seule fois',
            headerColor: '#4CAF50',
            accentColor: '#FFD54F',
            primaryTextColor: '#2E7D32',
            borderColor: '#4CAF50'
        };
        let rgpdSettings = {
            checkboxText: 'J\'accepte la politique de protection des donn√©es. <a href="#" id="rgpdLink" style="color: var(--primary); text-decoration: underline; font-weight: 600;">Cliquez ici pour consulter</a>',
            fullText: `<h3 style="color: var(--dark); margin-top: 20px;">Qui sommes-nous ?</h3>
<p>Ce jeu-concours est organis√© par <strong>Votre Entreprise</strong>.</p>

<h3 style="color: var(--dark); margin-top: 20px;">Quelles donn√©es collectons-nous ?</h3>
<p>Nous collectons uniquement les informations suivantes :</p>
<ul style="margin-left: 20px;">
    <li>Votre pr√©nom</li>
    <li>Votre nom</li>
    <li>Votre adresse email</li>
    <li>La date et l'heure de votre participation</li>
    <li>Le lot que vous avez gagn√©</li>
</ul>

<h3 style="color: var(--dark); margin-top: 20px;">Pourquoi collectons-nous ces donn√©es ?</h3>
<p>Vos donn√©es sont collect√©es uniquement pour :</p>
<ul style="margin-left: 20px;">
    <li>G√©rer votre participation au jeu-concours</li>
    <li>Vous attribuer votre lot en cas de gain</li>
    <li>√âviter les participations multiples</li>
    <li>Valider votre bon cadeau</li>
</ul>

<h3 style="color: var(--dark); margin-top: 20px;">Combien de temps conservons-nous vos donn√©es ?</h3>
<p>Vos donn√©es sont conserv√©es pendant toute la dur√©e du jeu-concours et supprim√©es √† la fin de celui-ci.</p>

<h3 style="color: var(--dark); margin-top: 20px;">Vos droits</h3>
<p>Conform√©ment au RGPD, vous disposez des droits suivants :</p>
<ul style="margin-left: 20px;">
    <li><strong>Droit d'acc√®s :</strong> Vous pouvez demander une copie de vos donn√©es</li>
    <li><strong>Droit de rectification :</strong> Vous pouvez corriger vos donn√©es</li>
    <li><strong>Droit √† l'effacement :</strong> Vous pouvez demander la suppression de vos donn√©es</li>
    <li><strong>Droit d'opposition :</strong> Vous pouvez vous opposer au traitement de vos donn√©es</li>
</ul>
<p>Pour exercer vos droits, contactez-nous √† : <strong>contact@exemple.com</strong></p>

<h3 style="color: var(--dark); margin-top: 20px;">S√©curit√©</h3>
<p>Vos donn√©es sont stock√©es de mani√®re s√©curis√©e. Elles ne sont jamais transmises √† des tiers.</p>`
        };
        let rgpdConsented = false;
        let emailResetPeriod = 'never';
        let lastReset = null;
        let currentPage = 1;
        const itemsPerPage = 50;
        let currentVoucherToValidate = null;
        let syncInterval = null;
        let lastSyncTime = 0;
        const SYNC_INTERVAL_MS = 2000; // Synchronisation toutes les 2 secondes
        let isCurrentlyInAdmin = false;

        // Couleurs pour la roue (tons verts)
        const COLORS = ['#4CAF50', '#66BB6A', '#81C784', '#A5D6A7', '#2E7D32', '#388E3C', '#43A047', '#C8E6C9'];

        // G√©n√©ration d'un code unique
        function generateVoucherCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 12; i++) {
                if (i > 0 && i % 4 === 0) code += '-';
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // G√©n√©ration du PDF avec le bon (personnalisable)
        async function generatePDF(voucherCode, prizeName, email, firstName, lastName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Convertir les couleurs hex en RGB
            function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? [
                    parseInt(result[1], 16),
                    parseInt(result[2], 16),
                    parseInt(result[3], 16)
                ] : [76, 175, 80];
            }

            const headerColor = hexToRgb(pdfSettings.headerColor);
            const accentColor = hexToRgb(pdfSettings.accentColor);
            const primaryColor = hexToRgb(pdfSettings.primaryTextColor);
            const borderColor = hexToRgb(pdfSettings.borderColor);

            // Date du jour
            const today = new Date();
            const dateStr = today.toLocaleDateString('fr-FR');

            // Fond d√©coratif en haut
            doc.setFillColor(...headerColor);
            doc.rect(0, 0, 210, 50, 'F');

            // Titre (sans emojis)
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(32);
            doc.setFont(undefined, 'bold');
            const cleanTitle = pdfSettings.title.replace(/[\u{1F000}-\u{1F9FF}]/gu, '').replace(/[^\x00-\x7F]/g, '');
            doc.text(cleanTitle || 'FELICITATIONS !', 105, 30, { align: 'center' });

            // Date
            doc.setFontSize(12);
            doc.text(dateStr, 105, 45, { align: 'center' });

            // Lot gagn√© (centr√©, sans nom/pr√©nom)
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(16);
            const cleanYouWonText = pdfSettings.youWonText.replace(/[^\x00-\x7F]/g, '');
            doc.text(cleanYouWonText, 105, 70, { align: 'center' });

            doc.setFillColor(...accentColor);
            doc.roundedRect(30, 85, 150, 35, 5, 5, 'F');

            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(...primaryColor);
            // Nettoyer le nom du lot de tout caract√®re sp√©cial
            const cleanPrizeName = prizeName.replace(/[^\x00-\x7F]/g, '');
            doc.text(cleanPrizeName, 105, 107, { align: 'center' });

            // Code
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.setFont(undefined, 'normal');
            const cleanCodeLabel = pdfSettings.codeLabel.replace(/[^\x00-\x7F]/g, '');
            doc.text(cleanCodeLabel, 105, 145, { align: 'center' });

            doc.setDrawColor(...primaryColor);
            doc.setLineWidth(2);
            doc.roundedRect(40, 155, 130, 25, 3, 3);

            doc.setFontSize(18);
            doc.setFont('courier', 'bold');
            doc.setTextColor(...primaryColor);
            doc.text(voucherCode, 105, 172, { align: 'center' });

            // G√©n√©rer QR code
            const qrContainer = document.createElement('div');
            qrContainer.style.display = 'none';
            document.body.appendChild(qrContainer);

            const qrCode = new QRCode(qrContainer, {
                text: voucherCode,
                width: 128,
                height: 128
            });

            await new Promise(resolve => setTimeout(resolve, 100));

            const qrImage = qrContainer.querySelector('img');
            if (qrImage) {
                doc.addImage(qrImage.src, 'PNG', 70, 195, 70, 70);
            }
            document.body.removeChild(qrContainer);

            // Instructions
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(0, 0, 0);
            const cleanInstr1 = pdfSettings.instruction1.replace(/[^\x00-\x7F]/g, '');
            const cleanInstr2 = pdfSettings.instruction2.replace(/[^\x00-\x7F]/g, '');
            doc.text(cleanInstr1, 105, 275, { align: 'center' });
            doc.text(cleanInstr2, 105, 283, { align: 'center' });

            // Bordure
            doc.setDrawColor(...borderColor);
            doc.setLineWidth(0.5);
            doc.rect(10, 10, 190, 287);

            // Nom du fichier : BON CADEAU FERMYLAND + date
            const fileDate = today.toISOString().split('T')[0]; // Format YYYY-MM-DD
            doc.save(`BON CADEAU FERMYLAND ${fileDate}.pdf`);
        }

        // Initialisation
        async function init() {
            await loadData();
            
            // Assurer la compatibilit√© avec les anciens lots et pr√©server les couleurs
            prizes = prizes.map((prize, index) => ({
                name: prize.name,
                percentage: prize.percentage,
                isWinning: prize.isWinning !== undefined ? prize.isWinning : !prize.name.toLowerCase().includes('r√©essayez'),
                message: prize.message || '',
                color: prize.color || COLORS[index % COLORS.length]
            }));
            
            applyCustomTexts();
            applyRgpdSettings();
            drawWheel();
            renderPrizesList();
            renderParticipants();
            setupEventListeners();
            
            // √âcouter les changements de localStorage (synchronisation entre onglets du m√™me navigateur)
            window.addEventListener('storage', (e) => {
                if (e.key === STORAGE_KEYS.LAST_UPDATE) {
                    console.log('üîÑ Changement d√©tect√© depuis un autre onglet');
                    syncData();
                }
            });
            
            // D√©marrer la synchronisation automatique m√™me sur la page de jeu
            // pour synchroniser avec d'autres appareils
            const storedTimestamp = localStorage.getItem(STORAGE_KEYS.LAST_UPDATE);
            lastSyncTime = storedTimestamp ? parseInt(storedTimestamp) : Date.now();
            syncInterval = setInterval(syncData, SYNC_INTERVAL_MS);
            
            console.log('‚úÖ Application initialis√©e - Synchronisation multi-appareils active');
        }

        // Sauvegarder les param√®tres RGPD
        async function saveRgpdSettings() {
            const messageDiv = document.getElementById('rgpdMessage');

            rgpdSettings.checkboxText = document.getElementById('rgpdCheckboxTextInput').value;
            rgpdSettings.fullText = document.getElementById('rgpdFullTextInput').value;

            try {
                localStorage.setItem(STORAGE_KEYS.RGPD_SETTINGS, JSON.stringify(rgpdSettings));
                applyRgpdSettings();
                messageDiv.innerHTML = '<div class="message success">‚úì Param√®tres RGPD enregistr√©s avec succ√®s !</div>';
                setTimeout(() => messageDiv.innerHTML = '', 3000);
            } catch (error) {
                console.error('Error saving RGPD settings:', error);
                messageDiv.innerHTML = `<div class="message error">‚ùå Erreur: ${error.message}</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
            }
        }

        // Chargement des donn√©es avec localStorage
        async function loadData() {
            try {
                const prizesData = localStorage.getItem(STORAGE_KEYS.PRIZES);
                prizes = prizesData ? JSON.parse(prizesData) : DEFAULT_PRIZES;
                
                // Assurer que chaque lot a une couleur
                prizes = prizes.map((prize, index) => ({
                    ...prize,
                    color: prize.color || COLORS[index % COLORS.length]
                }));
            } catch {
                prizes = DEFAULT_PRIZES;
            }

            try {
                const participantsData = localStorage.getItem(STORAGE_KEYS.PARTICIPANTS);
                participants = participantsData ? JSON.parse(participantsData) : [];
            } catch {
                participants = [];
            }

            try {
                const vouchersData = localStorage.getItem(STORAGE_KEYS.VOUCHERS);
                vouchers = vouchersData ? JSON.parse(vouchersData) : [];
            } catch {
                vouchers = [];
            }

            try {
                const passwordData = localStorage.getItem(STORAGE_KEYS.ADMIN_PASSWORD);
                adminPassword = passwordData || 'admin123';
            } catch {
                adminPassword = 'admin123';
            }

            try {
                const textsData = localStorage.getItem(STORAGE_KEYS.CUSTOM_TEXTS);
                if (textsData) {
                    customTexts = JSON.parse(textsData);
                    applyCustomTexts();
                }
            } catch {
                // Utiliser les valeurs par d√©faut
            }

            try {
                const resetPeriodData = localStorage.getItem('wheel-reset-period');
                emailResetPeriod = resetPeriodData || 'never';
            } catch {
                emailResetPeriod = 'never';
            }

            try {
                const lastResetData = localStorage.getItem('wheel-last-reset');
                lastReset = lastResetData || null;
            } catch {
                lastReset = null;
            }

            try {
                const pdfSettingsData = localStorage.getItem(STORAGE_KEYS.PDF_SETTINGS);
                if (pdfSettingsData) {
                    pdfSettings = JSON.parse(pdfSettingsData);
                }
            } catch {
                // Utiliser les valeurs par d√©faut
            }

            try {
                const rgpdSettingsData = localStorage.getItem(STORAGE_KEYS.RGPD_SETTINGS);
                if (rgpdSettingsData) {
                    rgpdSettings = JSON.parse(rgpdSettingsData);
                    applyRgpdSettings();
                }
            } catch {
                // Utiliser les valeurs par d√©faut
            }

            try {
                const rgpdConsentData = localStorage.getItem(STORAGE_KEYS.RGPD_CONSENT);
                rgpdConsented = rgpdConsentData === 'true';
            } catch {
                rgpdConsented = false;
            }
        }

        // Sauvegarde des donn√©es avec localStorage
        async function saveData() {
            try {
                localStorage.setItem(STORAGE_KEYS.PRIZES, JSON.stringify(prizes));
                localStorage.setItem(STORAGE_KEYS.PARTICIPANTS, JSON.stringify(participants));
                localStorage.setItem(STORAGE_KEYS.VOUCHERS, JSON.stringify(vouchers));
                
                // Enregistrer le timestamp pour la synchronisation
                const timestamp = Date.now();
                localStorage.setItem(STORAGE_KEYS.LAST_UPDATE, timestamp.toString());
                
                return true;
            } catch (error) {
                console.error('Error in saveData:', error);
                return false;
            }
        }

        // Synchronisation automatique des donn√©es
        async function syncData() {
            try {
                const storedTimestamp = localStorage.getItem(STORAGE_KEYS.LAST_UPDATE);
                const currentTimestamp = storedTimestamp ? parseInt(storedTimestamp) : 0;
                
                // Si les donn√©es ont √©t√© modifi√©es depuis la derni√®re synchro
                if (currentTimestamp > lastSyncTime) {
                    console.log('üîÑ Synchronisation - Mise √† jour des donn√©es...');
                    
                    // Recharger les donn√©es
                    const prizesData = localStorage.getItem(STORAGE_KEYS.PRIZES);
                    if (prizesData) {
                        prizes = JSON.parse(prizesData);
                        prizes = prizes.map((prize, index) => ({
                            ...prize,
                            color: prize.color || COLORS[index % COLORS.length]
                        }));
                    }
                    
                    const participantsData = localStorage.getItem(STORAGE_KEYS.PARTICIPANTS);
                    if (participantsData) {
                        participants = JSON.parse(participantsData);
                    }
                    
                    const vouchersData = localStorage.getItem(STORAGE_KEYS.VOUCHERS);
                    if (vouchersData) {
                        vouchers = JSON.parse(vouchersData);
                    }
                    
                    // Mettre √† jour l'affichage si on est dans l'admin
                    if (isCurrentlyInAdmin) {
                        const activeTab = document.querySelector('.tab-btn.active');
                        if (activeTab) {
                            const tabName = activeTab.dataset.tab;
                            
                            if (tabName === 'participants') {
                                renderParticipants();
                            } else if (tabName === 'vouchers') {
                                renderVouchers();
                            } else if (tabName === 'prizes') {
                                renderPrizesList();
                                drawWheel();
                            }
                        }
                    }
                    
                    lastSyncTime = currentTimestamp;
                    console.log('‚úÖ Synchronisation termin√©e');
                }
            } catch (error) {
                console.error('Erreur de synchronisation:', error);
            }
        }

        // D√©marrer la synchronisation automatique
        function startAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            console.log('üîÑ Synchronisation automatique activ√©e (toutes les 2 secondes)');
            
            const storedTimestamp = localStorage.getItem(STORAGE_KEYS.LAST_UPDATE);
            lastSyncTime = storedTimestamp ? parseInt(storedTimestamp) : Date.now();
            
            syncInterval = setInterval(syncData, SYNC_INTERVAL_MS);
        }

        // Arr√™ter la synchronisation
        function stopAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                console.log('‚è∏Ô∏è Synchronisation automatique arr√™t√©e');
            }
        }

        // Dessin de la roue
        function drawWheel() {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 240;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            let currentAngle = 0;
            prizes.forEach((prize, index) => {
                const sliceAngle = (prize.percentage / 100) * 2 * Math.PI;

                ctx.beginPath();
                // Utiliser la couleur personnalis√©e du lot ou une couleur par d√©faut
                ctx.fillStyle = prize.color || COLORS[index % COLORS.length];
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(currentAngle + sliceAngle / 2);
                ctx.textAlign = 'center';
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Poppins';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 4;
                ctx.fillText(prize.name, radius * 0.65, 5);
                ctx.restore();

                currentAngle += sliceAngle;
            });
        }

        // S√©lection al√©atoire bas√©e sur les probabilit√©s
        function selectPrize() {
            const random = Math.random() * 100;
            let cumulative = 0;

            for (let i = 0; i < prizes.length; i++) {
                cumulative += prizes[i].percentage;
                if (random <= cumulative) {
                    return i;
                }
            }
            return prizes.length - 1;
        }

        // Animation de la roue
        function spinWheel(prizeIndex, email, firstName, lastName) {
            const wheel = document.getElementById('wheelRotate');
            const baseRotation = 360 * 5; // 5 tours complets
            
            // Calculer l'angle de d√©part pour chaque tranche
            let targetAngle = 0;
            for (let i = 0; i < prizeIndex; i++) {
                targetAngle += (prizes[i].percentage / 100) * 360;
            }
            // Viser le milieu de la tranche gagnante
            targetAngle += (prizes[prizeIndex].percentage / 100) * 360 / 2;
            
            // Avec la fl√®che √† droite, on tourne simplement vers l'angle cible
            const finalRotation = baseRotation - targetAngle;

            wheel.style.transform = `rotate(${finalRotation}deg)`;

            setTimeout(() => {
                showResult(prizes[prizeIndex], email, firstName, lastName);
                isSpinning = false;
            }, 4000);
        }

        // Affichage du r√©sultat
        async function showResult(prize, email, firstName, lastName) {
            const customMessage = prize.message || 
                (prize.isWinning ? `Vous avez gagn√© : ${prize.name}` : prize.name);

            if (prize.isWinning) {
                const voucherCode = generateVoucherCode();

                const voucher = {
                    code: voucherCode,
                    email: email,
                    firstName: firstName,
                    lastName: lastName,
                    prize: prize.name,
                    createdAt: new Date().toLocaleString('fr-FR'),
                    status: 'valid',
                    validatedAt: null
                };

                vouchers.push(voucher);
                await saveData();

                // Stocker temporairement les infos pour le t√©l√©chargement PDF
                window.tempPdfData = { voucherCode, prizeName: prize.name, email, firstName, lastName };

                document.getElementById('resultText').innerHTML = 
                    `<strong>${customMessage}</strong><br><br>
                    <strong>Votre code unique :</strong><br>
                    <span style="font-size: 2rem; color: var(--primary); font-family: 'Courier New', monospace; font-weight: bold;">${voucherCode}</span><br><br>
                    <button class="play-btn" onclick="downloadPDF()" style="margin-top: 20px;">
                        ${customTexts.pdfButtonText}
                    </button>`;
            } else {
                document.getElementById('resultText').innerHTML = `<strong>${customMessage}</strong>`;
            }

            document.getElementById('resultModal').classList.add('active');
        }

        // Fonction pour t√©l√©charger le PDF
        async function downloadPDF() {
            if (window.tempPdfData) {
                const { voucherCode, prizeName, email, firstName, lastName } = window.tempPdfData;
                await generatePDF(voucherCode, prizeName, email, firstName, lastName);
            }
        }

        // Appliquer les textes personnalis√©s
        function applyCustomTexts() {
            // Logo
            const logoImage = document.getElementById('logoImage');
            const logoText = document.getElementById('logoText');
            
            if (customTexts.logoUrl && customTexts.logoUrl.trim()) {
                logoImage.src = customTexts.logoUrl;
                logoImage.style.display = 'block';
            } else {
                logoImage.style.display = 'none';
            }
            
            logoText.textContent = customTexts.siteName;
            
            // Autres textes
            document.querySelector('h1').textContent = customTexts.mainTitle;
            document.querySelector('.subtitle').textContent = customTexts.subtitle;
            document.getElementById('playBtn').textContent = customTexts.playButton;
            document.getElementById('firstNameInput').placeholder = customTexts.firstNamePlaceholder;
            document.getElementById('lastNameInput').placeholder = customTexts.lastNamePlaceholder;
            document.getElementById('emailInput').placeholder = customTexts.emailPlaceholder;
            document.querySelector('#resultModal h2').textContent = customTexts.resultTitle;
        }

        // Appliquer les param√®tres RGPD
        function applyRgpdSettings() {
            // Mettre √† jour le texte de la checkbox
            const checkboxTextElement = document.getElementById('rgpdCheckboxText');
            if (checkboxTextElement) {
                checkboxTextElement.innerHTML = rgpdSettings.checkboxText;
                
                // R√©attacher l'event listener au lien
                const rgpdLink = document.getElementById('rgpdLink');
                if (rgpdLink) {
                    rgpdLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.getElementById('rgpdModal').classList.add('active');
                    });
                }
            }
            
            // Mettre √† jour le contenu de la modal
            const rgpdContent = document.getElementById('rgpdContent');
            if (rgpdContent) {
                rgpdContent.innerHTML = rgpdSettings.fullText;
            }
        }

        // Charger les champs de param√®tres
        function loadSettingsFields() {
            document.getElementById('textLogoUrl').value = customTexts.logoUrl || '';
            document.getElementById('textSiteName').value = customTexts.siteName;
            document.getElementById('textMainTitle').value = customTexts.mainTitle;
            document.getElementById('textSubtitle').value = customTexts.subtitle;
            document.getElementById('textPlayButton').value = customTexts.playButton;
            document.getElementById('textFirstNamePlaceholder').value = customTexts.firstNamePlaceholder;
            document.getElementById('textLastNamePlaceholder').value = customTexts.lastNamePlaceholder;
            document.getElementById('textEmailPlaceholder').value = customTexts.emailPlaceholder;
            document.getElementById('textResultTitle').value = customTexts.resultTitle;
            document.getElementById('textPdfButton').value = customTexts.pdfButtonText;
            document.getElementById('emailResetPeriodSelect').value = emailResetPeriod;
            
            // RGPD
            document.getElementById('rgpdCheckboxTextInput').value = rgpdSettings.checkboxText;
            document.getElementById('rgpdFullTextInput').value = rgpdSettings.fullText;
        }

        // V√©rifier et appliquer la r√©initialisation des emails selon la p√©riode
        async function checkEmailReset() {
            if (emailResetPeriod === 'never' || !lastReset) {
                return;
            }

            const now = new Date();
            const lastResetDate = new Date(lastReset);
            const diffTime = Math.abs(now - lastResetDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            let shouldReset = false;
            switch (emailResetPeriod) {
                case 'daily':
                    shouldReset = diffDays >= 1;
                    break;
                case '2days':
                    shouldReset = diffDays >= 2;
                    break;
                case '3days':
                    shouldReset = diffDays >= 3;
                    break;
                case 'weekly':
                    shouldReset = diffDays >= 7;
                    break;
            }

            if (shouldReset) {
                participants = [];
                lastReset = now.toISOString();
                await saveData();
            }
        }

        // Sauvegarde des textes
        async function saveCustomTexts() {
            const messageDiv = document.getElementById('textsMessage');

            customTexts.logoUrl = document.getElementById('textLogoUrl').value;
            customTexts.siteName = document.getElementById('textSiteName').value;
            customTexts.mainTitle = document.getElementById('textMainTitle').value;
            customTexts.subtitle = document.getElementById('textSubtitle').value;
            customTexts.playButton = document.getElementById('textPlayButton').value;
            customTexts.firstNamePlaceholder = document.getElementById('textFirstNamePlaceholder').value;
            customTexts.lastNamePlaceholder = document.getElementById('textLastNamePlaceholder').value;
            customTexts.emailPlaceholder = document.getElementById('textEmailPlaceholder').value;
            customTexts.resultTitle = document.getElementById('textResultTitle').value;
            customTexts.pdfButtonText = document.getElementById('textPdfButton').value;

            console.log('Saving custom texts:', customTexts);

            try {
                localStorage.setItem(STORAGE_KEYS.CUSTOM_TEXTS, JSON.stringify(customTexts));
                console.log('Custom texts saved successfully');
                
                applyCustomTexts();
                messageDiv.innerHTML = '<div class="message success">‚úì Textes enregistr√©s avec succ√®s !</div>';
                setTimeout(() => messageDiv.innerHTML = '', 3000);
            } catch (error) {
                console.error('Error saving texts:', error);
                messageDiv.innerHTML = `<div class="message error">‚ùå Erreur: ${error.message || 'Impossible de sauvegarder'}</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
            }
        }

        // Sauvegarder la p√©riode de r√©initialisation
        async function saveResetPeriod() {
            emailResetPeriod = document.getElementById('emailResetPeriodSelect').value;
            
            try {
                localStorage.setItem('wheel-reset-period', emailResetPeriod, true);
                
                // Si on active une p√©riode, enregistrer la date actuelle
                if (emailResetPeriod !== 'never') {
                    lastReset = new Date().toISOString();
                    localStorage.setItem('wheel-last-reset', lastReset, true);
                }
                
                alert('‚úì P√©riode de r√©initialisation enregistr√©e !');
            } catch (error) {
                console.error('Error saving reset period:', error);
                alert('Erreur lors de la sauvegarde');
            }
        }

        // Exporter les participants en Excel (CSV)
        function exportToExcel() {
            if (participants.length === 0) {
                alert('Aucun participant √† exporter');
                return;
            }

            // Cr√©er le contenu CSV
            let csv = 'Pr√©nom,Nom,Email,Lot Gagn√©,Date\n';
            participants.forEach(p => {
                csv += `"${p.firstName || ''}","${p.lastName || ''}","${p.email}","${p.prize}","${p.date}"\n`;
            });

            // Cr√©er le blob et t√©l√©charger
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `participants_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // R√©initialiser les participations
        async function resetParticipants() {
            if (!confirm('√ätes-vous s√ªr de vouloir r√©initialiser la liste des emails ? Les participants pourront rejouer mais l\'historique sera conserv√©.')) {
                return;
            }

            // On garde l'historique mais on vide la liste pour permettre de rejouer
            participants = [];
            lastReset = new Date().toISOString();
            
            try {
                localStorage.setItem(STORAGE_KEYS.PARTICIPANTS, JSON.stringify(participants), true);
                localStorage.setItem('wheel-last-reset', lastReset, true);
                renderParticipants();
                alert('‚úì Liste des emails r√©initialis√©e ! Les personnes peuvent maintenant rejouer.');
            } catch (error) {
                console.error('Error resetting participants:', error);
                alert('Erreur lors de la r√©initialisation');
            }
        }

        // Charger les param√®tres PDF
        function loadPdfSettings() {
            document.getElementById('pdfTitle').value = pdfSettings.title;
            document.getElementById('pdfYouWonText').value = pdfSettings.youWonText;
            document.getElementById('pdfCodeLabel').value = pdfSettings.codeLabel;
            document.getElementById('pdfInstruction1').value = pdfSettings.instruction1;
            document.getElementById('pdfInstruction2').value = pdfSettings.instruction2;
            document.getElementById('pdfHeaderColor').value = pdfSettings.headerColor;
            document.getElementById('pdfAccentColor').value = pdfSettings.accentColor;
            document.getElementById('pdfPrimaryTextColor').value = pdfSettings.primaryTextColor;
            document.getElementById('pdfBorderColor').value = pdfSettings.borderColor;
        }

        // Sauvegarder les param√®tres PDF
        async function savePdfSettings() {
            const messageDiv = document.getElementById('pdfMessage');

            pdfSettings.title = document.getElementById('pdfTitle').value;
            pdfSettings.youWonText = document.getElementById('pdfYouWonText').value;
            pdfSettings.codeLabel = document.getElementById('pdfCodeLabel').value;
            pdfSettings.instruction1 = document.getElementById('pdfInstruction1').value;
            pdfSettings.instruction2 = document.getElementById('pdfInstruction2').value;
            pdfSettings.headerColor = document.getElementById('pdfHeaderColor').value;
            pdfSettings.accentColor = document.getElementById('pdfAccentColor').value;
            pdfSettings.primaryTextColor = document.getElementById('pdfPrimaryTextColor').value;
            pdfSettings.borderColor = document.getElementById('pdfBorderColor').value;

            console.log('Saving PDF settings:', pdfSettings);

            try {
                localStorage.setItem(STORAGE_KEYS.PDF_SETTINGS, JSON.stringify(pdfSettings));
                console.log('PDF settings saved successfully');
                
                messageDiv.innerHTML = '<div class="message success">‚úì Param√®tres PDF enregistr√©s avec succ√®s !</div>';
                setTimeout(() => messageDiv.innerHTML = '', 3000);
            } catch (error) {
                console.error('Error saving PDF settings:', error);
                messageDiv.innerHTML = `<div class="message error">‚ùå Erreur: ${error.message || 'Impossible de sauvegarder'}</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
            }
        }

        // Changer le mot de passe
        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const messageDiv = document.getElementById('passwordMessage');

            if (!window.storage || !window.storage.set) {
                messageDiv.innerHTML = '<div class="message error">‚ùå Erreur: Le syst√®me de stockage n\'est pas disponible</div>';
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            if (current !== adminPassword) {
                messageDiv.innerHTML = '<div class="message error">Mot de passe actuel incorrect</div>';
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            if (!newPass || newPass.length < 4) {
                messageDiv.innerHTML = '<div class="message error">Le mot de passe doit contenir au moins 4 caract√®res</div>';
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            if (newPass !== confirm) {
                messageDiv.innerHTML = '<div class="message error">Les mots de passe ne correspondent pas</div>';
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            try {
                adminPassword = newPass;
                const result = localStorage.setItem(STORAGE_KEYS.ADMIN_PASSWORD, adminPassword, true);
                console.log('Password save result:', result);

                if (result) {
                    messageDiv.innerHTML = '<div class="message success">‚úì Mot de passe modifi√© avec succ√®s !</div>';
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    setTimeout(() => messageDiv.innerHTML = '', 3000);
                } else {
                    throw new Error('Aucun r√©sultat retourn√©');
                }
            } catch (error) {
                console.error('Error changing password:', error);
                messageDiv.innerHTML = `<div class="message error">‚ùå Erreur: ${error.message || 'Impossible de sauvegarder'}</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
            }
        }

        // V√©rifier le mot de passe admin
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('passwordError');

            if (input === adminPassword) {
                document.getElementById('passwordModal').classList.remove('active');
                document.getElementById('gameSection').classList.remove('active');
                document.getElementById('adminSection').classList.add('active');
                
                // Activer la synchronisation automatique
                isCurrentlyInAdmin = true;
                startAutoSync();
                
                renderPrizesList();
                renderParticipants();
                renderVouchers();
                loadSettingsFields();
            } else {
                errorDiv.innerHTML = '<div class="message error">Mot de passe incorrect</div>';
                setTimeout(() => errorDiv.innerHTML = '', 3000);
            }
        }

        // Gestion du bouton jouer
        async function handlePlay() {
            const firstName = document.getElementById('firstNameInput').value.trim();
            const lastName = document.getElementById('lastNameInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();
            const rgpdChecked = document.getElementById('rgpdCheckbox').checked;
            const messageDiv = document.getElementById('message');

            if (!firstName) {
                messageDiv.innerHTML = '<div class="message error">Veuillez entrer votre pr√©nom</div>';
                return;
            }

            if (!lastName) {
                messageDiv.innerHTML = '<div class="message error">Veuillez entrer votre nom</div>';
                return;
            }

            if (!email || !email.includes('@')) {
                messageDiv.innerHTML = '<div class="message error">Veuillez entrer un email valide</div>';
                return;
            }

            if (!rgpdChecked) {
                messageDiv.innerHTML = '<div class="message error">Vous devez accepter la politique de protection des donn√©es pour participer</div>';
                return;
            }

            // V√©rifier si l'email peut rejouer selon la p√©riode
            await checkEmailReset();

            if (participants.some(p => p.email === email)) {
                messageDiv.innerHTML = '<div class="message error">Cet email a d√©j√† particip√© !</div>';
                return;
            }

            if (isSpinning) return;
            isSpinning = true;
            messageDiv.innerHTML = '';

            const prizeIndex = selectPrize();
            const prize = prizes[prizeIndex];

            participants.push({
                firstName: firstName,
                lastName: lastName,
                email: email,
                prize: prize.name,
                date: new Date().toLocaleString('fr-FR')
            });

            await saveData();
            spinWheel(prizeIndex, email, firstName, lastName);
        }

        // Gestion des onglets admin
        function setupEventListeners() {
            document.getElementById('playBtn').addEventListener('click', handlePlay);
            
            // Afficher le modal de mot de passe au lieu d'ouvrir directement l'admin
            document.getElementById('adminToggle').addEventListener('click', () => {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').innerHTML = '';
            });

            document.getElementById('cancelPassword').addEventListener('click', () => {
                document.getElementById('passwordModal').classList.remove('active');
            });

            document.getElementById('submitPassword').addEventListener('click', checkPassword);

            document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            document.getElementById('backBtn').addEventListener('click', () => {
                isCurrentlyInAdmin = false;
                stopAutoSync();
                document.getElementById('adminSection').classList.remove('active');
                document.getElementById('gameSection').classList.add('active');
            });

            document.getElementById('closeModal').addEventListener('click', () => {
                document.getElementById('resultModal').classList.remove('active');
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    e.target.classList.add('active');
                    const tabName = e.target.dataset.tab;
                    document.getElementById(tabName + 'Tab').classList.add('active');
                    
                    if (tabName === 'vouchers') {
                        renderVouchers();
                    } else if (tabName === 'settings') {
                        loadSettingsFields();
                    } else if (tabName === 'pdf') {
                        loadPdfSettings();
                    }
                });
            });

            document.getElementById('addPrizeBtn').addEventListener('click', addPrizeRow);
            document.getElementById('savePrizesBtn').addEventListener('click', savePrizes);
            document.getElementById('verifyVoucherBtn').addEventListener('click', verifyVoucher);
            document.getElementById('confirmValidateBtn').addEventListener('click', confirmValidation);
            document.getElementById('cancelValidateBtn').addEventListener('click', cancelValidation);
            document.getElementById('toggleQrScannerBtn').addEventListener('click', startQrScanner);
            document.getElementById('stopQrScannerBtn').addEventListener('click', stopQrScanner);
            document.getElementById('saveTextsBtn').addEventListener('click', saveCustomTexts);
            document.getElementById('changePasswordBtn').addEventListener('click', changePassword);
            document.getElementById('saveResetPeriodBtn').addEventListener('click', saveResetPeriod);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportVouchersBtn').addEventListener('click', exportVouchersToExcel);
            document.getElementById('resetVouchersBtn').addEventListener('click', resetVouchers);
            document.getElementById('resetEmailsNowBtn').addEventListener('click', resetParticipants);
            document.getElementById('savePdfSettingsBtn').addEventListener('click', savePdfSettings);
            document.getElementById('saveRgpdBtn').addEventListener('click', saveRgpdSettings);
            
            // Pagination
            document.getElementById('prevPageBtn').addEventListener('click', goToPreviousPage);
            document.getElementById('nextPageBtn').addEventListener('click', goToNextPage);
            
            // RGPD Modal - juste fermer quand on clique sur le bouton
            document.getElementById('closeRgpdModal').addEventListener('click', () => {
                document.getElementById('rgpdModal').classList.remove('active');
            });
        }

        // D√©marrer le scanner QR
        function startQrScanner() {
            const scannerContainer = document.getElementById('qrScannerContainer');
            scannerContainer.style.display = 'block';
            document.getElementById('toggleQrScannerBtn').style.display = 'none';

            if (!qrScanner) {
                qrScanner = new Html5Qrcode("qrReader");
            }

            qrScanner.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                },
                (decodedText) => {
                    document.getElementById('voucherCodeInput').value = decodedText;
                    stopQrScanner();
                    verifyVoucher();
                },
                (errorMessage) => {
                }
            ).catch(err => {
                console.error('Erreur scanner:', err);
                alert('Impossible d\'acc√©der √† la cam√©ra. Veuillez v√©rifier les permissions.');
                stopQrScanner();
            });
        }

        // Arr√™ter le scanner QR
        function stopQrScanner() {
            if (qrScanner) {
                qrScanner.stop().then(() => {
                    document.getElementById('qrScannerContainer').style.display = 'none';
                    document.getElementById('toggleQrScannerBtn').style.display = 'inline-block';
                }).catch(err => {
                    console.error('Erreur arr√™t scanner:', err);
                });
            }
        }

        // Ajout d'une ligne de lot
        function addPrizeRow() {
            prizes.push({ 
                name: '', 
                percentage: 0, 
                isWinning: true, 
                message: '' 
            });
            renderPrizesList();
        }

        // Rendu de la liste des lots
        function renderPrizesList() {
            const container = document.getElementById('prizesList');
            container.innerHTML = '';

            prizes.forEach((prize, index) => {
                const div = document.createElement('div');
                div.className = 'prize-item';
                div.style.gridTemplateColumns = '1fr';
                div.style.gap = '15px';
                
                // Assurer qu'il y a une couleur par d√©faut
                if (!prize.color) {
                    prize.color = COLORS[index % COLORS.length];
                }
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 2fr 1fr auto auto auto; gap: 15px; align-items: center;">
                        <input type="text" class="prize-input" value="${prize.name}" 
                               placeholder="Nom du lot (ex: iPhone 15)" 
                               data-index="${index}" data-field="name">
                        <input type="number" class="percentage-input" value="${prize.percentage}" 
                               placeholder="%" min="0" max="100" 
                               data-index="${index}" data-field="percentage">
                        <input type="color" value="${prize.color}" 
                               data-index="${index}" data-field="color"
                               style="width: 50px; height: 40px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer;"
                               title="Couleur du lot sur la roue">
                        <label class="checkbox-label">
                            <input type="checkbox" class="winning-checkbox" 
                                   ${prize.isWinning ? 'checked' : ''} 
                                   data-index="${index}" data-field="isWinning">
                            <span>Gagnant</span>
                        </label>
                        <button class="remove-prize-btn" data-index="${index}">‚úï</button>
                    </div>
                    <textarea class="message-input" 
                              placeholder="Message personnalis√© √† afficher (ex: F√©licitations ! Vous avez gagn√©...)"
                              data-index="${index}" 
                              data-field="message" 
                              rows="2">${prize.message || ''}</textarea>
                `;
                container.appendChild(div);
            });

            container.querySelectorAll('.prize-input, .percentage-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    const field = e.target.dataset.field;
                    const value = field === 'percentage' ? parseFloat(e.target.value) : e.target.value;
                    prizes[index][field] = value;
                });
            });

            container.querySelectorAll('input[type="color"]').forEach(input => {
                input.addEventListener('change', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    prizes[index].color = e.target.value;
                    drawWheel(); // Redessiner la roue imm√©diatement
                });
            });

            container.querySelectorAll('.message-input').forEach(textarea => {
                textarea.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    prizes[index].message = e.target.value;
                });
            });

            container.querySelectorAll('.winning-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    prizes[index].isWinning = e.target.checked;
                });
            });

            container.querySelectorAll('.remove-prize-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    prizes.splice(index, 1);
                    renderPrizesList();
                });
            });
        }

        // Sauvegarde des lots
        async function savePrizes() {
            const messageDiv = document.getElementById('adminMessage');
            
            console.log('Saving prizes...', prizes);
            
            const total = prizes.reduce((sum, p) => sum + (parseFloat(p.percentage) || 0), 0);
            if (Math.abs(total - 100) > 0.1) {
                messageDiv.innerHTML = `<div class="message error">Le total des pourcentages doit √™tre √©gal √† 100% (actuellement ${total.toFixed(1)}%)</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            if (prizes.some(p => !p.name.trim())) {
                messageDiv.innerHTML = '<div class="message error">Tous les lots doivent avoir un nom</div>';
                setTimeout(() => messageDiv.innerHTML = '', 5000);
                return;
            }

            try {
                localStorage.setItem(STORAGE_KEYS.PRIZES, JSON.stringify(prizes));
                console.log('Prizes saved successfully');
                
                messageDiv.innerHTML = '<div class="message success">‚úì Lots enregistr√©s avec succ√®s !</div>';
                drawWheel();
                setTimeout(() => messageDiv.innerHTML = '', 3000);
            } catch (error) {
                console.error('Error saving prizes:', error);
                messageDiv.innerHTML = `<div class="message error">‚ùå Erreur: ${error.message || 'Impossible de sauvegarder'}</div>`;
                setTimeout(() => messageDiv.innerHTML = '', 5000);
            }
        }

        // Rendu des participants avec pagination
        function renderParticipants() {
            const tbody = document.getElementById('participantsBody');
            tbody.innerHTML = '';

            const totalParticipants = participants.length;
            document.getElementById('participantsCount').textContent = totalParticipants;

            if (totalParticipants === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px; color: #999;">Aucun participant pour le moment</td></tr>';
                document.getElementById('pageInfo').textContent = 'Page 0/0';
                document.getElementById('prevPageBtn').disabled = true;
                document.getElementById('nextPageBtn').disabled = true;
                return;
            }

            const totalPages = Math.ceil(totalParticipants / itemsPerPage);
            
            // S'assurer que la page courante est valide
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalParticipants);
            const pageParticipants = participants.slice(startIndex, endIndex);

            pageParticipants.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Pr√©nom">${p.firstName || '-'}</td>
                    <td data-label="Nom">${p.lastName || '-'}</td>
                    <td data-label="Email">${p.email}</td>
                    <td data-label="Lot Gagn√©">${p.prize}</td>
                    <td data-label="Date">${p.date}</td>
                `;
                tbody.appendChild(tr);
            });

            // Mise √† jour de l'interface de pagination
            document.getElementById('pageInfo').textContent = `Page ${currentPage}/${totalPages}`;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
        }

        // Fonctions de navigation
        function goToPreviousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderParticipants();
            }
        }

        function goToNextPage() {
            const totalPages = Math.ceil(participants.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderParticipants();
            }
        }

        // V√©rifier un bon (pr√©visualisation)
        function verifyVoucher() {
            const codeInput = document.getElementById('voucherCodeInput');
            const code = codeInput.value.trim().toUpperCase();
            const messageDiv = document.getElementById('validationMessage');
            const previewDiv = document.getElementById('voucherPreview');

            if (!code) {
                messageDiv.innerHTML = '<div class="message error">Veuillez entrer un code</div>';
                previewDiv.style.display = 'none';
                return;
            }

            const voucher = vouchers.find(v => v.code === code);

            if (!voucher) {
                messageDiv.innerHTML = '<div class="message error">‚ùå Code invalide ou inexistant</div>';
                previewDiv.style.display = 'none';
                currentVoucherToValidate = null;
                return;
            }

            // Afficher la pr√©visualisation
            currentVoucherToValidate = voucher;
            document.getElementById('previewCode').textContent = voucher.code;
            document.getElementById('previewFirstName').textContent = voucher.firstName || '-';
            document.getElementById('previewLastName').textContent = voucher.lastName || '-';
            document.getElementById('previewEmail').textContent = voucher.email;
            document.getElementById('previewPrize').textContent = voucher.prize;
            document.getElementById('previewDate').textContent = voucher.createdAt;
            
            const statusBadge = voucher.status === 'valid' 
                ? '<span style="color: #4CAF50; font-weight: bold;">‚úì Valide</span>'
                : '<span style="color: #f44336; font-weight: bold;">‚úó D√©j√† utilis√© le ' + voucher.validatedAt + '</span>';
            document.getElementById('previewStatus').innerHTML = statusBadge;

            previewDiv.style.display = 'block';
            messageDiv.innerHTML = '';
        }

        // Confirmer la validation du bon
        async function confirmValidation() {
            const messageDiv = document.getElementById('validationMessage');
            const previewDiv = document.getElementById('voucherPreview');
            const codeInput = document.getElementById('voucherCodeInput');

            if (!currentVoucherToValidate) {
                messageDiv.innerHTML = '<div class="message error">Aucun bon √† valider</div>';
                return;
            }

            if (currentVoucherToValidate.status === 'used') {
                messageDiv.innerHTML = `<div class="message error">‚ùå Ce bon a d√©j√† √©t√© utilis√© le ${currentVoucherToValidate.validatedAt}</div>`;
                previewDiv.style.display = 'none';
                currentVoucherToValidate = null;
                return;
            }

            // Valider le bon
            currentVoucherToValidate.status = 'used';
            currentVoucherToValidate.validatedAt = new Date().toLocaleString('fr-FR');
            await saveData();

            const fullName = (currentVoucherToValidate.firstName && currentVoucherToValidate.lastName) 
                ? `${currentVoucherToValidate.firstName} ${currentVoucherToValidate.lastName}` 
                : 'Participant';

            messageDiv.innerHTML = `<div class="message success">
                ‚úÖ Bon valid√© avec succ√®s !<br>
                <strong>Participant:</strong> ${fullName}<br>
                <strong>Lot:</strong> ${currentVoucherToValidate.prize}<br>
                <strong>Email:</strong> ${currentVoucherToValidate.email}
            </div>`;

            previewDiv.style.display = 'none';
            codeInput.value = '';
            currentVoucherToValidate = null;
            renderVouchers();
        }

        // Annuler la validation
        function cancelValidation() {
            document.getElementById('voucherPreview').style.display = 'none';
            document.getElementById('validationMessage').innerHTML = '';
            currentVoucherToValidate = null;
        }

        // Exporter les bons en Excel
        function exportVouchersToExcel() {
            if (vouchers.length === 0) {
                alert('Aucun bon √† exporter');
                return;
            }

            // Cr√©er le contenu CSV
            let csv = 'Code,Pr√©nom,Nom,Email,Lot,Date cr√©ation,Statut,Date validation\n';
            vouchers.forEach(v => {
                csv += `"${v.code}","${v.firstName || ''}","${v.lastName || ''}","${v.email}","${v.prize}","${v.createdAt}","${v.status}","${v.validatedAt || ''}"\n`;
            });

            // Cr√©er le blob et t√©l√©charger
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `bons_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // R√©initialiser l'historique des bons
        async function resetVouchers() {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer TOUT l\'historique des bons ? Cette action est irr√©versible.')) {
                return;
            }

            vouchers = [];
            
            try {
                await saveData();
                renderVouchers();
                alert('‚úì Historique des bons r√©initialis√© avec succ√®s !');
            } catch (error) {
                console.error('Error resetting vouchers:', error);
                alert('Erreur lors de la r√©initialisation');
            }
        }

        // Rendu de la liste des bons
        function renderVouchers() {
            const tbody = document.getElementById('vouchersBody');
            tbody.innerHTML = '';

            if (vouchers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px; color: #999;">Aucun bon g√©n√©r√© pour le moment</td></tr>';
                return;
            }

            const sortedVouchers = [...vouchers].reverse();

            sortedVouchers.forEach(v => {
                const tr = document.createElement('tr');
                const statusBadge = v.status === 'valid' 
                    ? '<span class="status-badge valid">‚úì Valide</span>'
                    : '<span class="status-badge used">‚úó Utilis√©</span>';

                tr.innerHTML = `
                    <td data-label="Code"><strong>${v.code}</strong></td>
                    <td data-label="Pr√©nom">${v.firstName || '-'}</td>
                    <td data-label="Nom">${v.lastName || '-'}</td>
                    <td data-label="Email">${v.email}</td>
                    <td data-label="Lot">${v.prize}</td>
                    <td data-label="Date cr√©ation">${v.createdAt}</td>
                    <td data-label="Statut">${statusBadge}</td>
                    <td data-label="Date validation">${v.validatedAt || '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Lancement de l'application
        init();
    </script>
</body>
</html>
